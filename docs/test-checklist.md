# テストチェックリスト

## テスト実施日: 2026-01-31, 2026-02-01

---

## 1. Free枠の自動発行

| # | テスト内容 | 期待結果 | 結果 | 備考 |
|---|-----------|---------|------|------|
| 1-1 | ストレージクリア後に経費チェック | 自動でFreeキー発行、チェック実行 | ✅ | |
| 1-2 | 発行されたキーが `ftc_free_` 形式 | `ftc_free_xxxxxxxx-...` | ✅ | |
| 1-3 | 同じIPで再度クリア→チェック | 既存キーが復元される or エラー | ✅ | |
| 1-4 | Free枠5回使い切り | 上限エラーが表示される | ✅ | |

---

## 2. 勘定科目フィルター（Pro制限）

| # | テスト内容 | 期待結果 | 結果 | 備考 |
|---|-----------|---------|------|------|
| 2-1 | Freeユーザーでフィルターボタン | アップグレードモーダル表示 | ✅ | |
| 2-2 | モーダルの価格表示 | 「1,078円（税込）」 | ✅ | |
| 2-3 | モーダルの「閉じる」ボタン | モーダルが閉じる | ✅ | |
| 2-4 | Proユーザーでフィルターボタン | フィルターパネル表示 | ✅ | |
| 2-5 | フィルター機能の動作 | 勘定科目の非表示が機能する | ✅ | |

---

## 3. 価格表示

| # | テスト内容 | 期待結果 | 結果 | 備考 |
|---|-----------|---------|------|------|
| 3-1 | popup.html Proプラン案内 | 「980円（税別）」表示 | ✅ | |
| 3-2 | フィルターのアップグレードモーダル | 「1,078円（税込）」表示 | ✅ | |
| 3-3 | 使用状況のアップグレードリンク | PayPal決済ページに遷移 | ✅ | |

---

## 4. ライセンス・プラン表示

| # | テスト内容 | 期待結果 | 結果 | 備考 |
|---|-----------|---------|------|------|
| 4-1 | Proキーで検証 | 「∞」表示、アップグレード導線非表示 | ✅ | |
| 4-2 | Freeキーで検証 | 「X / 5」表示、アップグレード導線表示 | ✅ | |
| 4-3 | 無効なキーで検証 | エラーメッセージ、キャッシュクリア | ✅ | |
| 4-4 | 空欄で検証ボタン | 「キーを入力してください」エラー | ✅ | |

---

## 5. チェック機能

| # | テスト内容 | 期待結果 | 結果 | 備考 |
|---|-----------|---------|------|------|
| 5-1 | 支出登録でチェック実行 | ボタンが緑に変わり、結果モーダル表示 | ✅ | |
| 5-2 | 🟢判定 + autoRegister ON | 自動で登録される | ✅ | |
| 5-3 | 🟢判定 + autoRegister OFF | モーダル表示のまま、手動確認必要 | ✅ | |
| 5-4 | チェック無効設定 | チェックスキップ、即登録 | ✅ | |
| 5-5 | 収入登録 | チェックなし、即登録 | ✅ | |

---

## 6. オプションページ（家事按分）

| # | テスト内容 | 期待結果 | 結果 | 備考 |
|---|-----------|---------|------|------|
| 6-1 | 「項目を編集...」ボタン | オプションページが開く | ✅ | |
| 6-2 | 項目の追加 | 新しい按分項目が追加される | ✅ | |
| 6-3 | 項目の削除 | 項目が削除される | ✅ | |
| 6-4 | 保存ボタン | 「保存しました」表示 | ✅ | |
| 6-5 | 「閉じて戻る」ボタン | タブが閉じる | ✅ | |

---

## 7. PayPal本番Webhook（IPN）

| # | テスト内容 | 期待結果 | 結果 | 備考 |
|---|-----------|---------|------|------|
| 7-1 | 1円テストプランで決済 | 決済完了 | ✅ | plan_id: P-89B34021UH427020WNF7JM4Q |
| 7-2 | IPN受信 | Vercelログに `recurring_payment` 表示 | ✅ | |
| 7-3 | ライセンスキー生成 | `ftc_` 形式のキーが生成 | ✅ | ftc_57d9b0b3-03bd-4e7c-b475-1ce73dc5c29d |
| 7-4 | メール送信 | 購入者にライセンスキーメール届く | ✅ | toukarekeywordsearch@gmail.com |

---

## 結果サマリー

| カテゴリ | 合格 | 不合格 | 未実施 |
|---------|------|--------|--------|
| Free枠自動発行 | 4 | | |
| フィルターPro制限 | 5 | | |
| 価格表示 | 3 | | |
| ライセンス・プラン | 4 | | |
| チェック機能 | 5 | | |
| オプションページ | 5 | | |
| PayPal本番Webhook | 4 | | |
| **合計** | 30 | | |

---

## 発見した問題

| # | 問題内容 | 重要度 | ステータス |
|---|---------|--------|-----------|
| 1 | チェック実行後、収入/支出タブを切り替えてもボタンテキストが変わらない | 中 | ✅ 修正済み |
| 2 | PayPal WebhookがIPNで送信されていた（Developer DashboardのWebhookではなく） | 高 | ✅ 修正済み（IPN対応追加） |

---

## メモ

- テスト用Proキー: `ftc_9439e6f1-59a8-4ae2-9de4-9456d5b3d363`
- PayPal本番決済リンク（980円）: `https://www.paypal.com/webapps/billing/plans/subscribe?plan_id=P-84V60575XD453294JNF662HQ`
- PayPalテスト用リンク（1円）: `https://www.paypal.com/webapps/billing/plans/subscribe?plan_id=P-89B34021UH427020WNF7JM4Q`
- IPN設定URL: PayPalビジネスアカウント > 即時支払い通知(IPN) > 通知URL設定
